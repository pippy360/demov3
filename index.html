<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="math.js" type="text/javascript"></script>
    <!--<script src="http://d3js.org/d3.v3.min.js"></script>-->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css"
          integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
          rel="stylesheet">
    <style>
        document {
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
        }
        .nav {
            border-bottom: 0px;
        }
        .nav>li {
            cursor: pointer;
        }

        .nav>li>a {
            padding: 10px 15px;
            display: block;
            position: relative;
        }

        .nav>li.active>a {
            color: #555;
            cursor: default;
            background-color: #fff;
            border: 1px solid #ddd;
            border-bottom-color: transparent;
            border-top-right-radius: 4px;
            border-top-left-radius: 4px;
        }

        #mainContentContainer {
            padding: 0px 30px;
            margin: 0px auto;
            width: 1200px;
            display: block;
        }

        .btn {
            cursor: pointer;
        }

        .demoAreaContainer {
            width: 1140px;
            display: block;
        }

        .bigCanvasContainerWrapper {
            width: 1140px;
            float: left;
            margin-bottom: 20px;
        }

        .bigCanvasContainer {
            width: 910px;
            margin: auto;
        }

        .prevBtn {
            float: left;
            margin-left: 35px;
        }
  
        .nextBtn {
            float: right;
            margin-right: 35px;
        }
        
        .move {
            cursor: move;
        }

        #lineSvgTag {
            pointer-events: none;
        }

        .btn {
            font-size: 12px;
        }

        #triangleOutputList {
            max-width: 400px;
            height: 320px;
            overflow: auto;
            margin-top: 20px;
        }

        .canvasWrapperLeft {
            display: block;
            /*width: 285px;*/
            float: left;
            margin-top: 35px;
            margin-bottom: 40px;
            margin-right: 68px;
            position: relative;
        }

        .canvasWrapperRight {
            display: block;
            /*width: 285px;*/
            float: right;
            margin-top: 35px;
            margin-bottom: 40px;
            position: relative;
        }

        .trianglesListWrapper {
            margin-left: 40px;
            height: 260px;
            width: 400px;
            display: inline-block;
            float: right;
        }

        .distanceOutputHelpMessage {
            padding: 8px;
            text-align: center;
        }

        .trianglesListInnerWrapper {
            height: 230px;
            display: block;
            overflow: auto;
            border-bottom: 1px solid rgba(0, 0, 0, 0.19);
	    background-color: #fff;
        }

        .table-striped > tbody > tr:nth-child(2n+1) > td, .table-striped > tbody > tr:nth-child(2n+1) > th {
            background-color: rgba(0, 0, 0, 0.01);
        }

        .triangleListBody {
            overflow: auto;
        }

        .header {
            background-color: #183D4E;
            width: 100%;
            min-width: 1200px;
            color: #ffffff;
            overflow: hidden;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border-bottom: solid 1px rgba(0,0,0,0.4);
        }

        .headerInner {
            margin: 35px auto;
            width: 1140px;
        }

        .headerInner h1 {
            font-size: 32px;
        }

        .buttonsWrapper {
            width: 100%;
            min-width: 1200px;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }

        .buttonsInner {
            margin: 8px auto 0px auto;
            padding: 2px 30px;
            width: 1200px;
        }

        .canvasTitle {
            color: rgba(0, 0, 0, .8);
            display: block;
            font-size: 12px;
            margin-bottom: 5px;
            padding-bottom: 0px;
        }

        .canvasTitleRight {
            position: absolute;
            top: 0px;
            right: 0px;
            font-size: 12px;
        }

        .triangleCountOutput {
            color: rgba(0, 0, 0, .8);
            display: block;
            font-size: 12px;
            margin: 0px;
            padding: 0px;
            margin-top: 3px;
        }

        #output {
            width: 1100px;
            margin: auto;
        }

        .aboutAreaWrapper {
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 0px 4px rgba(0, 0, 0, 0.1);
            margin: auto;
            width: 100%;
            min-width: 1200px;
        }
        .aboutArea {
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            color: rgba(0,0,0,0.7);
            width: 700px;
            padding: 80px 0px;
            margin: auto;
        }

        .smallCanvasWrapper {
            /*width: 750px;*/
            height: 200px;
        }

        #fragmentCanvas2 {

            float: right;
        }

        .distanceOutput {
            width: 308px;
            float: left;
        }

        .distanceOutputTitle {
            padding-top: 30px;
            font-size: 16px;
            color: rgba(0, 0, 0, .87);
            text-align: center;
            width: 100%;
        }

        .distanceOutputData {
            width: 100%;
            text-align: center;
            font-size: 20px;
            color: black;
        }
	    
        .valid {
            color: #2c662e;
        }

        .invalid {
            color: #f44336;
        }
        .fragmentCanvasWrapper {
            /*width: 165px;*/
            float: left;
        }

        .mainContentContainerWrapper {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            background-color: #f7f7f7;
            width: 100%;
            min-width: 1200px;
            padding-bottom: 60px;
            height: 700px;
        }

        .transformationsLabel {
            font-size: 12px;
        }

        .selectedTriangleTR {
            background-color: rgba(24, 61, 78, .9);
            color: white;
        }

        .fishImage {
            width: 485px;
            height: 222px;
            background-image: url('images/fish_1.jpg');
            background-size: 485px 222px;
            background-repeat: no-repeat;
        }

        .fishImage:hover {
            background-image: url('images/fish_2.jpg');
        }

        .canvasBottom {
            position: absolute;
        }

        .canvasTop {
            position: absolute;
        }

        .canvasClickThrough {
            position: absolute;
            pointer-events: none;
        }

        .twoCanvasWrapper {
        }

        .interactiveCanvasWrapper {
            width: 280px;
            height: 280px;
            cursor: pointer;
	    touch-action: none;
        }

        .referenceCanvasWrapper {
            width: 560px;
            height: 280px;
        }

        .canvasShadow {
            /*border: 1px solid black;*/
            box-shadow: 0px 0px 8px 2px rgba(24, 61, 78, .2);
        }
        .moreWrapper {
            position: relative;
            width: 100%;
            min-width: 1200px;
        }
        .more {
            position: absolute;
            left: 50%;
            top: 50%;
        }
        .moreButton {
            position: absolute;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            box-shadow: 0 4px 5px 0 rgba(0,0,0,.14), 0 1px 10px 0 rgba(0,0,0,.12), 0 2px 4px -1px rgba(0,0,0,.2);
            border: 0px;
            background-color: white;
            top: -28px;
            left: -28px;
        }

        body:after{
            display:none;
            content: url('images/fish_1.jpg') url('images/fish_2.jpg');
        }

        .dropdown-menu li {
            cursor: pointer;
        }

        .backgroundColourGrey {
            background-color: #eee;
        }

        .triangleList tr{
            text-align: center;
        }
        #matchNoMatchLabel{
            text-align: center;
        }

        p {
            font-size: 20px;
        }

        .figureText {
            margin-top: 20px;
            width: 100%;
            display: block;
            text-align: center;
            font-weight: bold;
        }
        .stepsWrapper {
            padding: 0px 40px;
        }
        .boldListNumber{
            font-weight: bold;
        }

	#queryImageCanvasUiOverlay{
	    touch-action: none;
	}
    </style>
</head>
<body>
<a href="https://github.com/pippy360/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
<div class="fullPageWraper">
    <div class="header">
        <div class="headerInner">
            <h1>Image Matching Demo</h1>
            <p>Click and drag on the query image to apply a transformation.</p>
        </div>
    </div>
    <div class="buttonsWrapper">
        <div class="buttonsInner">
            <span data-toggle="buttons">
                <label id="translateButton" class="btn btn-secondary active"
                       onclick="setCurrnetOperation(enum_TransformationOperation.TRANSLATE)">
                    <input type="radio" name="options" autocomplete="off" checked>Move</input>
                </label>
                <label class="btn btn-secondary"
                       onclick="setCurrnetOperation(enum_TransformationOperation.NON_UNIFORM_SCALE)">
                    <input type="radio" name="options" autocomplete="off">Directional Scale</input>
                </label>
                <label class="btn btn-secondary"
                       onclick="setCurrnetOperation(enum_TransformationOperation.UNIFORM_SCALE)">
                    <input type="radio" name="options" autocomplete="off">Uniform Scale</input>
                </label>
                <label class="btn btn-secondary" onclick="setCurrnetOperation(enum_TransformationOperation.ROTATE)">
                    <input type="radio" name="options" autocomplete="off">Rotate</input>
                </label>
                <label class="btn btn-secondary" onclick="setCurrnetOperation(enum_TransformationOperation.CROP)">
                    <input type="radio" name="options" autocomplete="off">Crop</input>
                </label>
            </span>
            <!--<button class="btn btn-default" onclick="toggleDrawKeypointsMode()" >Toggle DrawKeypoints</button>-->
            <!--<button class="btn btn-default" style="float:right;" onclick="callSearch()">CompareImages</button>-->
            <span style="float: right">
                <span data-toggle="buttons">
                   <div style="float: left; padding-right: 10px;">
                        <button type="button" style="margin-bottom: 8px;" class="alert-danger btn btn-secondary"
                            onclick="reset()">Reset</button>
                   </div>

                   <!--<div class="dropdown" style="float: left">-->
                        <!--<button class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" type="button"-->
                                <!--name="options2" autocomplete="off">Settings<span-->
                                <!--class="caret"></span></button>-->
                    <!--<ul class="dropdown-menu dropdown-menu-right">-->
                        <!--<li class="dropdown-item" id="toggleDrawInteractiveUIOverlayButton" onclick="toggleDrawInteractiveUIOverlayWrapper()"><a href="#">Toggle draw 1st canvas UI overlay</a></li>-->
                        <!--<li class="dropdown-item" id="toggleDrawReferenceUIOverlayButton" onclick="toggleDrawReferenceUIOverlayWrapper()"><a href="#">Toggle draw 2nd canvas UI overlay</a></li>-->
                    <!--</ul>-->
                   <!--</div>-->
                </span>
            </span>
        </div>
    </div>
    <div class="mainContentContainerWrapper">
        <div id="mainContentContainer" class="">
            <div class="clickAndDragTitle">
            </div>
            <div class="demoAreaContainer">
                <div id="bigCanvasContainerWrapper" class="bigCanvasContainerWrapper">
                    <div id="bigCanvasContainer" class="bigCanvasContainer">
                        <div class="canvasWrapperLeft">
                            <label class="canvasTitle">Query Image</label>
                            <div class="radio canvasTitleRight" id="interactiveUiToggle">
                                <label class="checkbox-inline">
                                    Show UI overlay
                                    <input type="checkbox" id="inlineCheckbox2" value="option2" checked>
                                </label>
                            </div>
                            <div class="canvasShadow interactiveCanvasWrapper">
                                <canvas id="queryImageCanvasImageContent" class="canvasBottom" width="280"
                                        height="280"></canvas>
                                <canvas id="queryImageCanvasUiOverlay" class="canvasTop" width="280" height="280"></canvas>
                                <canvas id="queryImageCanvasImageOutline" class="canvasClickThrough" width="280" height="280"></canvas>
                                <canvas id="queryImageCanvasHighlightedTriangle" class="canvasClickThrough" width="280" height="280"></canvas>
                            </div>
                        </div>
                        <div class="canvasWrapperRight">
                            <label class="canvasTitle">Images Stored In Database</label>
                            <div class="radio canvasTitleRight" id="referenceUiToggle">
                                <label class="checkbox-inline">
                                    Show UI overlay
                                    <input type="checkbox" id="inlineCheckbox2" value="option2" checked>
                                </label>
                            </div>
                            <div class="canvasShadow referenceCanvasWrapper">
                                <canvas id="databaseImageCanvasImageContent" class="canvasBottom" width="560"
                                        height="280"></canvas>
                                <canvas id="databaseImageCanvasUiOverlay" class="canvasTop" width="560" height="280"></canvas>
                                <canvas id="databaseImageCanvasImageOutline" style="visibility: hidden" class="canvasClickThrough" width="560" height="280"></canvas>
                                <canvas id="databaseImageCanvasHighlightedTriangle" class="canvasClickThrough" width="560" height="280"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="output">
                    <div class="smallCanvasWrapper">
                        <div class="fragmentCanvasWrapper">
                            <canvas class="canvasShadow" id="fragmentCanvas1" height="160" width="160"></canvas>
                        </div>
                        <div class="distanceOutput">
                            <label class="distanceOutputTitle">Perceptual hash distance:</label>
                            <label id="pHashDistanceOutputWrapper" class="distanceOutputData"> 0 </label>
                            <button class="prevBtn btn btn-secondary" onclick="highlightPrevTriangle()">prev</button>
                            <button class="nextBtn btn btn-secondary" onclick="highlightNextTriangle()">next</button>
                            <div id="matchNoMatchLabel"></div>
                        </div>
                        <div class="fragmentCanvasWrapper">
                            <canvas class="canvasShadow" id="fragmentCanvas2" height="160" width="160"></canvas>
                        </div>
                        <div class="trianglesListWrapper">
                            <ul class="nav nav-tabs" id="myTabs" role="tablist">
                                <li role="presentation" class="active" ><a href="#listTab1" id="home-tab1" role="tab" data-toggle="tab" aria-controls="listTab1" aria-expanded="true">Image 1 matches</a></li>
                                <li role="presentation" ><a href="#listTab2" id="home-tab2" role="tab" data-toggle="tab" aria-controls="listTab2" aria-expanded="true">Image 2 matches</a></li>
                            </ul>
                            <div class="trianglesListInnerWrapper tab-content" id="trianglesListInnerWrapper">
                                <div id="listTab1" class="tab-pane show active">
                                    <table class="triangleList table ">
                                        <tbody id="triangleListBody1" role="menu">

                                        </tbody>
                                    </table>
                                </div>
                                <div id="listTab2" class="tab-pane">
                                    <table class="triangleList table ">
                                        <tbody id="triangleListBody2" role="menu">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="moreWrapper">
        <div class="more">
            <button class="moreButton"><i class="material-icons">keyboard_arrow_down</i></button>
        </div>
    </div>
    <div class="aboutAreaWrapper">
        <div class="aboutArea">
            <h2>About</h2>
            <p>
                This demo showcases an algorithm which performs 2D affine transformation-invariant partial image-matching in sublinear time. The algorithm compares the input to its database of preprocessed images and determines if the input matches any image in the database. The database need not contain the original image as inputs can be matched to any 2D affine transformation of the original. This means that images which have been scaled (uniformly or non-uniformly), skewed, translated, cropped or rotated (or have undergone any combination of these transformations) can be identified as coming from the same source image (Figure 1).
            </p>
            <p>
                The algorithm runs in sublinear time, regardless of the number of transformations applied or the number of images in the database. Note that if image-matching could not be done in sublinear time it would not function at the scale that the likes of Google or Microsoft require.
            </p>
            <br>
            <video  src="images/out26.mp4" controls loop></video>
            <span class="figureText">Figure 1. 2D affine transformation invariant image-matching</span>
            <br>
            <p>
                If the input is a composite of images or image fragments, the algorithm will return matches for each image/image fragment (Figure 2)
            </p>

            <br>
            <img src="images/matchingtris.png"  style="width: 100%"></img>
            <span class="figureText">Figure 2. The query image (c), which is a composite of (a) and (b), matches the two images (d) and (e) stored in the database</span>
            <br>
            <br>

            <br>
            <h2>How it Works</h2>
            <br>
            <p class="stepsWrapper">
                <span class="boldListNumber">1.</span>
                The algorithm finds keypoints in the input using edge detection<sup>1</sup>.
                <br>
                <br>
                <span class="boldListNumber">2.</span>
                Each set of three keypoints is converted into a triangle<sup>2</sup>.
                <br>
                <br>
                <span class="boldListNumber">3.</span>
                These triangles are transformed into equilateral triangles.
                <br>
                <br>
                <span class="boldListNumber">4.</span>
                A perceptual hashing algorithm (in this case PHash) is used to produce a hash for each triangle.
                <br>
                <br>
                <span class="boldListNumber">5.</span>
                The algorithm compares the hash to those stored in the database and returns all matching images<sup>3</sup>.
                <br>
                <br>
            </p>
            <p>
                All images in the database have been preprocessed in this manner to produce hashes for comparison.
            </p>
            <br>
            <br>
            <br>
            <video  src="images/out44.mp4" controls></video>
            <span class="figureText">Figure 3. Step-by-step video guide showing how the algorithm operates</span>
            <br>
            <p>
                <sup>1</sup> Any keypoint-finding software can be used so long as it is 2D affine transformation-invariant.
                <br>
                <sup>2</sup> The comparison can be done through a hash lookup (which can be done in constant time)
                or by finding a ‘nearest-neighbour’ in the database (which can be done
                in amortized log<sub><span style="font-size: 10px">2</span></sub>n time).
                <br>
                <sup>3</sup> The algorithm will return multiple matches if the input is a composite of images.
            </p>
            <br>
            <br>
            <br>
            <h2>How it Compares to the Competition</h2>
            <p>
                As you can see in Figure 4 below, the algorithm performs better than industry leaders in matching images which have undergone 2D affine transformations. Even the best-performing service, Google Image Search, fails to handle a simple 45 degree rotation.
            </p>
            <br>
            <img src="images/cats image.jpg" style="width: 100%">
            <b>Figure 4.</b> Comparison of the image-matching capabilities of our
            algorithm versus market leaders.
            <br>
            <br>
            <p>
                Market leaders show limited ability to find matches of images which have undergone certain transformations.
                Our algorithm solves this problem for 2D affine transformations and, if used in
                conjunction with other modern techniques, offers a significant improvement in reverse-image searching.
            </p>
            <br>

        </div>
    </div>
</div>
<svg id="lineSvgTag" style="display: inline;position: absolute; min-height: 4px;min-width: 4px;">
    <line id="line" x1="0" y1="0" x2="0" y2="0" style="stroke:rgb(255,0,0);stroke-width:2"/>
</svg>
<!-- jQuery first, then Tether, then Bootstrap JS. -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
        integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
        integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
        crossorigin="anonymous"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="main.js"></script>

<script>

$('#referenceUiToggle').change(function(e) {
    toggleDrawReferenceUIOverlayWrapper(e);
});

$('#interactiveUiToggle').change(function(e) {
    toggleDrawInteractiveUIOverlayWrapper(e);
});

$(".moreButton").click(function() {
	$('html, body').animate({		
		scrollTop: $(".moreButton").offset().top
	}, 500);		
});

$('#myTabs a').click(function (e) {
    e.preventDefault();
    $(this).tab('show');
    if (g_globalState == null) {
        //page not loaded yet
    } else {
        if ($(this)[0].id == "home-tab1") {
            g_globalState.highlightedTriangleListTabIndex = 0;
        } else {
            g_globalState.highlightedTriangleListTabIndex = 1;
        }
    }
});

</script>
</body>
<script>

</script>
</html>
